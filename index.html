<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Maze Game</title>

    <!-- RELIABLE THREE.JS (WORKS ON GITHUB PAGES) -->
    <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>

    <!-- Smooth camera controller (OrbitControls, no pointer lock) -->
    <script src="https://unpkg.com/three@0.158.0/examples/js/controls/OrbitControls.js"></script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
        }

        #healthbar {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 300px;
            height: 25px;
            background: rgb(60, 0, 0);
            border: 3px solid #900;
            border-radius: 8px;
        }

        #healthbar-inner {
            height: 100%;
            background: red;
            width: 100%;
            transition: width 0.2s;
            border-radius: 5px;
        }

        #startBtn {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 50px;
            background: white;
            border-radius: 10px;
            font-size: 20px;
            cursor: pointer;
            z-index: 5;
        }
    </style>
</head>

<body>

<div id="startBtn">Click to Start</div>
<div id="healthbar"><div id="healthbar-inner"></div></div>

<script>
/* ---------------------------------------------
   BASIC 3D SETUP
---------------------------------------------- */

let scene = new THREE.Scene();
scene.background = new THREE.Color(0x202020);

let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
camera.position.set(0, 5, 10);

let renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

/* ---------------------------------------------
   LIGHTING (better graphics)
---------------------------------------------- */
let sun = new THREE.DirectionalLight(0xffffff, 2);
sun.position.set(20, 50, 20);
scene.add(sun);

let ambient = new THREE.AmbientLight(0x777777);
scene.add(ambient);

/* ---------------------------------------------
   CAMERA CONTROLS (NO pointer lock)
---------------------------------------------- */
let controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enablePan = false;
controls.enableZoom = false;
controls.enableDamping = true;
controls.dampingFactor = 0.05;
controls.target.set(0, 3, 0);

/* ---------------------------------------------
   PLAYER
---------------------------------------------- */
let player = {
    x: 0,
    y: 2,
    z: 0,
    speed: 0.15,
    hp: 16
};

/* ---------------------------------------------
   CONTROLS
---------------------------------------------- */
let keys = {};
document.addEventListener("keydown", (e)=>keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", (e)=>keys[e.key.toLowerCase()] = false);

/* ---------------------------------------------
   MAZE GENERATION (BETTER LOOKING)
---------------------------------------------- */
let walls = [];
let mazeSize = 40;
let wallGeo = new THREE.BoxGeometry(5, 8, 5);
let wallMat = new THREE.MeshStandardMaterial({ color: 0x4444ff, roughness: 0.5 });

function createMaze() {
    for (let x = -mazeSize; x <= mazeSize; x += 5) {
        for (let z = -mazeSize; z <= mazeSize; z += 5) {
            if (Math.random() < 0.25) {
                let wall = new THREE.Mesh(wallGeo, wallMat);
                wall.position.set(x, 4, z);
                scene.add(wall);
                walls.push(wall);
            }
        }
    }
}
createMaze();

/* ---------------------------------------------
   SWORD (better graphics)
---------------------------------------------- */
let swordGeo = new THREE.BoxGeometry(0.5, 5, 1);
let swordMat = new THREE.MeshStandardMaterial({ color: 0xcccccc, metalness: 0.9, roughness: 0.2 });

let sword = new THREE.Mesh(swordGeo, swordMat);
sword.position.set(1.5, -1, -3);
camera.add(sword);
scene.add(camera);

/* ---------------------------------------------
   ENEMIES
---------------------------------------------- */
let enemies = [];
function spawnEnemy() {
    let geo = new THREE.SphereGeometry(1.2, 16, 16);
    let mat = new THREE.MeshStandardMaterial({ color: 0xff4444 });

    let enemy = new THREE.Mesh(geo, mat);
    enemy.position.set(
        (Math.random() - 0.5) * mazeSize * 2,
        1.2,
        (Math.random() - 0.5) * mazeSize * 2
    );

    enemy.hp = 1 + Math.floor(Math.random()*3); // 1â€“3 hits
    enemies.push(enemy);
    scene.add(enemy);
}

/* Spawn enemies every 3 seconds */
setInterval(spawnEnemy, 3000);

/* ---------------------------------------------
   MOVEMENT & COLLISION
---------------------------------------------- */
function movePlayer() {
    let forward = new THREE.Vector3();
    camera.getWorldDirection(forward);
    forward.y = 0;
    forward.normalize();

    let right = new THREE.Vector3();
    right.crossVectors(forward, new THREE.Vector3(0,1,0)).multiplyScalar(-1);

    let oldPos = camera.position.clone();

    if (keys["w"]) camera.position.addScaledVector(forward, player.speed);
    if (keys["s"]) camera.position.addScaledVector(forward, -player.speed);
    if (keys["a"]) camera.position.addScaledVector(right, -player.speed);
    if (keys["d"]) camera.position.addScaledVector(right, player.speed);

    // Collision check
    for (let w of walls) {
        if (camera.position.distanceTo(w.position) < 3) {
            camera.position.copy(oldPos);
        }
    }
}

/* ---------------------------------------------
   ENEMY LOGIC
---------------------------------------------- */
function updateEnemies() {
    enemies.forEach((e, i) => {

        // Move toward player
        let dir = camera.position.clone().sub(e.position).normalize();
        e.position.addScaledVector(dir, 0.05);

        // Damage player
        if (e.position.distanceTo(camera.position) < 2.0) {
            player.hp -= 1;
            updateHealth();
        }

        // Sword attack
        if (swinging && e.position.distanceTo(camera.position) < 4.0) {
            e.hp--;
            if (e.hp <= 0) {
                scene.remove(e);
                enemies.splice(i, 1);
            }
        }
    });
}

function updateHealth() {
    player.hp = Math.max(0, player.hp);
    document.getElementById("healthbar-inner").style.width = (player.hp / 16 * 100) + "%";
}

/* ---------------------------------------------
   SWORD SWING
---------------------------------------------- */
let swinging = false;
document.addEventListener("mousedown", () => {
    if (!swinging) {
        swinging = true;
        sword.rotation.x = -1.2;
        setTimeout(()=>{
            sword.rotation.x = 0;
            swinging = false;
        }, 200);
    }
});

/* ---------------------------------------------
   START BUTTON
---------------------------------------------- */
document.getElementById("startBtn").onclick = () => {
    document.getElementById("startBtn").style.display = "none";
};

/* ---------------------------------------------
   GAME LOOP
---------------------------------------------- */
function animate() {
    requestAnimationFrame(animate);
    movePlayer();
    updateEnemies();
    controls.update();
    renderer.render(scene, camera);
}
animate();

</script>
</body>
</html>
