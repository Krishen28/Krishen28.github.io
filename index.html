<!DOCTYPE html>
<html>
<head>
    <title>Basic 3D Maze</title>
    <style>
        body { margin: 0; overflow: hidden; }
        #startBtn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 40px;
            font-size: 20px;
            background: white;
            border-radius: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<button id="startBtn">Click to Start</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>

<script>
// ------------------------------------------------
// Basic setup
// ------------------------------------------------
let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 500);

let renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// ------------------------------------------------
// Pointer Lock
// ------------------------------------------------
const startBtn = document.getElementById("startBtn");
startBtn.onclick = () => {
    document.body.requestPointerLock();
    startBtn.style.display = "none";
};

let yaw = 0, pitch = 0;

document.addEventListener("mousemove", (e) => {
    if (document.pointerLockElement === document.body) {
        yaw -= e.movementX * 0.002;
        pitch -= e.movementY * 0.002;
        pitch = Math.max(-1.3, Math.min(1.3, pitch));
        camera.rotation.set(pitch, yaw, 0);
    }
});

// ------------------------------------------------
// Player movement
// ------------------------------------------------
let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

let speed = 0.1;

// ------------------------------------------------
// Build a VERY SIMPLE MAZE (guaranteed to work)
// ------------------------------------------------
let walls = [];

function createWall(x, z) {
    let wall = new THREE.Mesh(
        new THREE.BoxGeometry(1, 3, 1),
        new THREE.MeshBasicMaterial({ color: 0x5555ff })
    );
    wall.position.set(x, 1.5, z);
    scene.add(wall);
    walls.push(wall);
}

let layout = [
    "###################",
    "#.................#",
    "#..#####..........#",
    "#.................#",
    "#####........#####",
    "#.................#",
    "###################"
];

for (let z = 0; z < layout.length; z++) {
    for (let x = 0; x < layout[z].length; x++) {
        if (layout[z][x] === "#")
            createWall(x, -z);
    }
}

// ------------------------------------------------
// Floor
// ------------------------------------------------
let floor = new THREE.Mesh(
    new THREE.PlaneGeometry(100, 100),
    new THREE.MeshBasicMaterial({ color: 0x222222 })
);
floor.rotation.x = -Math.PI / 2;
scene.add(floor);

// ------------------------------------------------
// Collision detection
// ------------------------------------------------
function touchingWall(x, z) {
    for (let w of walls) {
        if (Math.abs(w.position.x - x) < 0.6 &&
            Math.abs(w.position.z - z) < 0.6) return true;
    }
    return false;
}

// ------------------------------------------------
// Game loop
// ------------------------------------------------
camera.position.set(2, 1.7, -2);

function animate() {
    requestAnimationFrame(animate);

    let forward = new THREE.Vector3(-Math.sin(yaw), 0, -Math.cos(yaw));
    let right = new THREE.Vector3(Math.cos(yaw), 0, -Math.sin(yaw));

    let newX = camera.position.x;
    let newZ = camera.position.z;

    if (keys["w"]) { newX += forward.x * speed; newZ += forward.z * speed; }
    if (keys["s"]) { newX -= forward.x * speed; newZ -= forward.z * speed; }
    if (keys["a"]) { newX -= right.x * speed;   newZ -= right.z * speed; }
    if (keys["d"]) { newX += right.x * speed;   newZ += right.z * speed; }

    if (!touchingWall(newX, newZ)) {
        camera.position.x = newX;
        camera.position.z = newZ;
    }

    renderer.render(scene, camera);
}

animate();

</script>

</body>
</html>
